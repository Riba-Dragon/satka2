function showNotify(type,title,message,delay){delay=typeof delay!=="undefined"?delay:5e3;$.notify({title:"<strong>"+title+"</strong>",message:message},{type:type,delay:delay,z_index:9999999})}$(function(){var feedbackWindow=$("#feedbackWindow");var feedbackStickyForm=$("#feedback-sticky-form");feedbackWindow.find(".caption, .btn-close").click(function(){feedbackWindow.find(".content").slideToggle("slow",function(){})});feedbackStickyForm.find("#sendFeedbackFromWindow").click(function(e){e.preventDefault();var ticket=feedbackStickyForm.find("textarea").val();feedbackStickyForm.find("button").prop("disabled",true);if(ticket.length>0){$.ajax({url:"/user/tickets/save",data:{ticket:ticket},dataType:"json",method:"POST",error:function(jqXHR,textStatus,errorThrown){console.log(jqXHR,textStatus,errorThrown);var alertMessage=jqXHR.responseText;showNotify("danger","Ошибка",alertMessage)},success:function(data,textStatus,jqXHR){if(data.status=="success"){showNotify("success","Спасибо за отзыв!",data.message,false);$("#feedback-sticky-form").find("textarea").val("")}else if(data.status=="error"){showNotify("danger","Ошибка",data.message)}else{showNotify("danger","Ошибка","Произошла ошибка. Наши специалисты уже в курсе о ней. Попробуйте оставить отзыв чуть позже.")}}})}feedbackStickyForm.find("button").prop("disabled",false)})});$(function(){var stepTemplateTemplateId=$(".step-design-list");stepTemplateTemplateId.find('input[type="radio"]').change(function(e){$(".screenshot img").hide();$('.screenshot img[data-template_id="'+$(this).val()+'"]').show()});var stepFormTemplateId=$(".step-form-list");stepFormTemplateId.find('input[type="radio"]').change(function(e){$(".example img").hide();$('.example img[data-template_id="'+$(this).val()+'"]').show()})});function applyResponsiveGrid(heightData){var headerBlock=$("#headerBlock");var contentBlock=$("#contentBlock");var footerBlock=$("#footerBlock");if(heightData.headerContentFooterBlockOuterHeight>heightData.browserOuterHeight){footerBlock.removeClass("fixed-footer")}else{footerBlock.addClass("fixed-footer");var paddingContent=(heightData.browserOuterHeight-heightData.headerContentFooterBlockHeight)/2;paddingContent=Math.floor(paddingContent);contentBlock.css("padding-top",paddingContent);contentBlock.css("padding-bottom",paddingContent)}}function applyEmbedAndBlockForm(){var embedBlock=$(".template-block-video-and-block-form #embedBlock");var formBlock=$(".template-block-video-and-block-form #formBlock");embedBlockHeight=embedBlock.outerHeight();formBlockHeight=formBlock.outerHeight(true);if(embedBlockHeight>formBlockHeight){var padding_top=+formBlock.css("padding-top").replace("px","");var padding_bottom=+formBlock.css("padding-bottom").replace("px","");var paddingFormBlock=(embedBlockHeight-formBlockHeight)/2;paddingFormBlock=Math.floor(paddingFormBlock);formBlock.css("padding-top",padding_top+paddingFormBlock);formBlock.css("padding-bottom",padding_bottom+paddingFormBlock)}else{embedBlock.outerHeight(formBlockHeight)}}function extractYoutubeIdFromUrl(url){var regExp=/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#\&\?]*).*/;var match=url.match(regExp);if(match&&match[7].length==11){return match[7]}else{return false}}function loadBgYoutubeVideo(youtube_video_id,height,width){console.log(youtube_video_id);g=window;var tag=document.createElement("script");tag.src="https://www.youtube.com/iframe_api";var firstScriptTag=document.getElementsByTagName("script")[0];firstScriptTag.parentNode.insertBefore(tag,firstScriptTag);g.onYouTubeIframeAPIReady=function(){g.player=new YT.Player("bgYoutubeCover",{videoId:youtube_video_id,height:"924px",width:"1567px",playerVars:{autoplay:1,controls:0,loop:1,playlist:youtube_video_id,modestbranding:0,showinfo:0,iv_load_policy:3,showsearch:0,fs:0,disablekb:1,rel:0},events:{onReady:onPlayerReady,onStateChange:onPlayerStateChange}})};g.onPlayerReady=function(event){event.target.mute();event.target.setPlaybackQuality("default")};g.done=false;g.onPlayerStateChange=function(event){if(event.data==YT.PlayerState.PLAYING&&!done){done=true}};g.stopVideo=function(){player.stopVideo()}}function fitCovers(hData){if(hData.browserHeight<hData.headerContentFooterBlockOuterHeight){$("body").height(hData.headerContentFooterBlockOuterHeight);$("#contentWrapper").height(hData.headerContentFooterBlockOuterHeight);$(".cover-filter").height(hData.headerContentFooterBlockOuterHeight);$(".videowrapper").height(hData.headerContentFooterBlockOuterHeight)}else{$("body").height(hData.browserOuterHeight);$("#contentWrapper").height(hData.browserOuterHeight);$(".cover-filter").height(hData.browserOuterHeight);$(".videowrapper").height(hData.browserOuterHeight)}}function autoPlayYouTubeModal(){var trigger=$("body").find('[data-toggle="modal"]');var yotubeString="http://www.youtube.com/embed/";trigger.click(function(){var theModal=$(this).data("target"),videoSrc=$(this).attr("data-youtube_id"),videoSrcAuto=yotubeString+videoSrc+"?autoplay=1";$(theModal+" iframe").attr("src",videoSrcAuto);$(theModal+" button.close").click(function(){$(theModal+" iframe").attr("src",videoSrc)});$(theModal).on("hide.bs.modal",function(e){$(theModal+" iframe").attr("src","")})})}function getDataFromEditorAndSidebar(){var page={};page.id=$("#hiddenPageId").val();page.created_user_id=$("#hiddenUserId").val();page.template_id=$("#sidebarTemplateId").val();page.yandex_metrika_id=$("#sidebarYandexMetrikaId").val();page.yandex_metrika_goal_id=$("#sidebarYandexMetrikaGoalId").val();page.google_analytics_id=$("#sidebarGoogleAnalyticsId").val();page.domain=$("#sidebarDomainName").val();page.form_id=$("#sidebarFormId").val();page.youtube_link=$.trim($("#sidebarVideoBlockUrl").val());page.background_video_link=$.trim($("#sidebarBgVideoUrl").val());page.title=$.trim($("#lpLogoBlock").html());page.phone=$.trim($("#lpPhoneBlock").html());page.email=$.trim($("#lpEmailBlock").html());page.address=$.trim($("#lpAddressBlock").html());page.law=$.trim($("#lpLawBlock").html());page.header1=$.trim($("#lpHeaderBlock").html());page.header2=$.trim($("#lpFactsBlock").html());page.region=$.trim($("#lpRegionBlock").html());page.form_caption=$.trim($("#lpFormCaptionBlock").html());page.form_button=$.trim($("#lpFormButtonBlock").html());return page}function getHeightData(){var headerBlock=$("#headerBlock");var contentBlock=$("#contentBlock");var footerBlock=$("#footerBlock");var hData={};hData.headerBlockOuterHeight=headerBlock.outerHeight(true);hData.contentBlockOuterHeight=contentBlock.outerHeight(true);hData.footerBlockOuterHeight=footerBlock.outerHeight(true);hData.browserOuterHeight=$(window).outerHeight(true);hData.headerBlockHeight=headerBlock.height();hData.contentBlockHeight=contentBlock.height();hData.footerBlockHeight=footerBlock.height();hData.browserHeight=$(window).height();hData.headerContentFooterBlockHeight=hData.contentBlockHeight+hData.headerBlockHeight+hData.footerBlockHeight;hData.headerContentFooterBlockOuterHeight=hData.contentBlockOuterHeight+hData.headerBlockOuterHeight+hData.footerBlockOuterHeight;return hData}function getWidthData(){var wData={};wData.browserWidth=$(window).width();return wData}function isMobile(){var is_mobile=false;if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4))){is_mobile=true}return is_mobile}function isMdOrLgGridSystem(){return $("#tbGridMd").css("display")!="none"||$("#tbGridLg").css("display")!="none"}function processYoutubeBackgroundVideo(div,height,bg_video_id){if(!$("#bgYoutubeCover").length){return false}var iframe=getBackgroundYoutubeIframe(bg_video_id,height,false);div.html(iframe);g=window;var tag=document.createElement("script");tag.src="https://www.youtube.com/iframe_api";var firstScriptTag=document.getElementsByTagName("script")[0];firstScriptTag.parentNode.insertBefore(tag,firstScriptTag);g.onYouTubeIframeAPIReady=function(){player=new YT.Player(iframe,{events:{onReady:onPlayerReady,onStateChange:onPlayerStateChange}})};g.onPlayerReady=function(event){event.target.mute();event.target.setPlaybackQuality("default")};var done=false;g.onPlayerStateChange=function(event){if(event.data==YT.PlayerState.PLAYING&&!done){done=true}};g.stopVideo=function(){player.stopVideo()}}function getBackgroundYoutubeIframe(bg_video_id,height,nocover){var iframe=document.createElement("iframe");iframe.src=getEmbedUrl(bg_video_id,nocover);iframe.frameBorder=0;var video_height=0;if(nocover!=true){if(!height){height="100vh"}var div_height=0;if(height.indexOf("vh")>-1){var wh=window.innerHeight;if(!wh){wh=$(window).height()}div_height=Math.floor(wh*(parseInt(height)/100))}else{div_height=parseInt(height)}var div_width=Math.floor(parseInt(window.innerWidth));if(!div_width){div_width=$(window).width()}var video_width=div_width;video_height=video_width*.5625;var vw2=video_width;var vh2=video_height+110+110;var delta_coef=1;if(video_height-220<div_height){if(video_height<div_height){delta_coef=div_height/video_height+.02}else{delta_coef=video_height/div_height+.02}}var zoom_video_width=Math.floor(vw2*delta_coef);var zoom_video_height=Math.floor(vh2*delta_coef);var heightDelta=zoom_video_height-div_height;var widthDelta=zoom_video_width-div_width;iframe.height=zoom_video_height+"px";iframe.width=zoom_video_width+"px";if(heightDelta>0){iframe.style.marginTop=-Math.floor(heightDelta/2)+"px"}if(widthDelta>0){iframe.style.marginLeft=-Math.floor(widthDelta/2)+"px"}}else{if(!height){video_height=Math.floor($(div).width()*.5625)}if(height&&height.indexOf("vh")>-1){video_height=Math.floor(window.innerHeight*(parseInt(height)/100))}else{if(height){video_height=parseInt(height)}}iframe.width="100%";iframe.height=video_height+"px"}return iframe}function getEmbedUrl(youtube_src,nocover){if(youtube_src.indexOf("https://www.youtube.com/embed")==-1){youtube_src="https://www.youtube.com/embed"+(youtube_src[0]=="/"?youtube_src:"/"+youtube_src)}var extractVideoId=function(youtube_src){var parts=youtube_src.split("/"),neededPart=null;for(var i=0,l=parts.length;i<l;i++){if(parts[i]=="embed"){neededPart=parts[i+1]}}return neededPart};var currentLocation=location.protocol+"//"+location.host;if(nocover!=true){youtube_src=(youtube_src[youtube_src.length-1]=="/"?youtube_src:youtube_src)+"?autoplay=1&loop=1&enablejsapi=1&&playerapiid=featuredytplayer&controls=0&modestbranding=1&rel=0&showinfo=0&color=white&iv_load_policy=3&theme=light&wmode=transparent&origin="+currentLocation+"&playlist="+extractVideoId(youtube_src)}else{youtube_src=(youtube_src[youtube_src.length-1]=="/"?youtube_src:youtube_src)+"?autoplay=0&loop=0&enablejsapi=1&&playerapiid=featuredytplayer&controls=1&modestbranding=1&rel=0&showinfo=0&color=black&iv_load_policy=3&theme=dark&wmode=transparent&origin="+currentLocation}return youtube_src}$(function(){var body=$("body");var mdOrLgGridSystem=isMdOrLgGridSystem();var hData=getHeightData();var wData=getWidthData();var is_mobile=isMobile();var bgYoutubeCover=$("#bgYoutubeCover");var bg_video_id=bgYoutubeCover.data("youtube_id");var editor_or_site_mode=$("#templateContent").length;console.log(editor_or_site_mode);if(editor_or_site_mode){if(mdOrLgGridSystem){applyResponsiveGrid(hData)}if(mdOrLgGridSystem){applyEmbedAndBlockForm(hData)}if(mdOrLgGridSystem){processYoutubeBackgroundVideo(bgYoutubeCover,hData.headerContentFooterBlockOuterHeight+"px",bg_video_id);fitCovers(hData)}autoPlayYouTubeModal();$(window).resize(function(){if(mdOrLgGridSystem){applyResponsiveGrid(hData);applyEmbedAndBlockForm(hData)}})}var trigger=$("#hamburgerIcon");var overlay=$("#overlay");var isClosed=false;trigger.click(function(){hamburger_cross()});function hamburger_cross(){if(isClosed==true){overlay.hide();trigger.removeClass("is-open");trigger.addClass("is-closed");isClosed=false}else{overlay.show();trigger.removeClass("is-closed");trigger.addClass("is-open");isClosed=true}}$('[data-toggle="offcanvas"]').click(function(){$("#editorLayout").toggleClass("toggled")});$("ul.dropdown-menu").on("click",function(event){event.stopPropagation()});$("#sidebarFormId").change(function(){$(".contact_form").hide();$('.contact_form[data-form_id="'+$(this).val()+'"]').show()});body.on("change","#sidebarTemplateId",function(){var page=getDataFromEditorAndSidebar();$.ajax({url:"/lp/editor/change-template",data:page,dataType:"json",method:"POST",error:function(jqXHR,textStatus,errorThrown){var alertMessage=jqXHR.responseText;showNotify("danger","Ошибка",alertMessage)},success:function(data,textStatus,jqXHR){if(data.status=="success"){$("#templateReplacementBlock").empty().html(data.html)}else if(data.status=="error"){showNotify("danger","Ошибка",data.message)}else{showNotify("danger","Ошибка","Произошла сохранения страницы. Наши специалисты уже в курсе. Попробуйте сохраниться страницу еще раз чуть позже.")}}})});body.on("click","#savePage",function(e){var page=getDataFromEditorAndSidebar();$.ajax({url:"/lp/editor/save",data:page,dataType:"json",method:"POST",error:function(jqXHR,textStatus,errorThrown){var alertMessage=jqXHR.responseText;showNotify("danger","Ошибка",alertMessage)},success:function(data,textStatus,jqXHR){if(data.status=="success"){$("#hiddenPageId").val(data.page_id);if(data.is_new_record==true){window.history.pushState("string","Title","editor/"+data.page_id)}if(data.template_is_changed==true){$("#templateContent").empty().html(data.html)}showNotify("success","Сохранено",data.message,false)}else if(data.status=="error"){showNotify("danger","Ошибка",data.message)}else{showNotify("danger","Ошибка","Произошла ошибка сохранения страницы. Наши специалисты уже в курсе. Попробуйте сохраниться страницу еще раз чуть позже.")}}});e.preventDefault()})});$(function(){$("#leadPipelineStatusInupt").on("change",function(){$.ajax({url:"/crm/leads/change-status",data:$("#changeLeadStatusForm").serialize(),dataType:"json",method:"POST",error:function(jqXHR,textStatus,errorThrown){console.log(jqXHR,textStatus,errorThrown);showNotify("danger","Ошибка","Не удалось изменить статус")},success:function(data,textStatus,jqXHR){console.log(data);if(data.status=="success"){console.log("success");showNotify("success","Успех!","Статус успешно изменен")}else{showNotify("danger","Ошибка","Не удалось изменить статус")}}})});var left_col_width=$("#crmColLeft").width();var right_col_width=$("#crmColRight").width();$("#crmLeftSidebar").width(left_col_width);$("#crmRightSidebar").width(right_col_width)});$(function(){if($(".lp-site-index").length){var page_item_height=$(".page-item").height();$(".page-item-create").height(page_item_height-1)}});